# One time secret

Еще одна проба пера на найденном в интернете тестовом задании.

### Задача:

Нужно сделать HTTP сервис для одноразовых секретов наподобие [https://onetimesecret.com/](https://onetimesecret.com/?locale=ru).

Он должен позволить создать секрет, задать кодовую фразу для его открытия и cгенерировать код, по которому можно прочитать секрет только один раз. UI не нужен, это должен быть JSON Api сервис.

Для написание сервиса можно использовать **FastAPI** или любой другой фреймворк.

- Метод `/generate` должен принимать секрет и кодовую фразу и отдавать `secret_key` по которому этот секрет можно получить.
- Метод `/secrets/{secret_key}` принимает на вход кодовую фразу и отдает секрет.

#### Требования:

- Язык программирования: Python 3.7+.
- Использование **Docker**, сервис должен запускаться с помощью `docker-compose up`.
- Требований к используемым технологиям нет.
- Код должен соответствовать PEP, необходимо использование type hints, к публичным методам должна быть написана документация на английском языке.

#### Усложнения:

- Написаны тесты (постарайтесь достичь покрытия в 70% и больше). Вы можете использовать **pytest** или любую другую библиотеку для тестирования.
- Сервис асинхронно обрабатывает запросы.
- Данные сервиса хранятся во внешнем хранилище, запуск которого также описан в `docker-compose`. Мы рекомендуем использовать **MongoDB**, но Вы можете использовать любую подходящую базу.
- Секреты и кодовые фразы не хранятся в базе в открытом виде.
- Добавлена возможность задавать время жизни для секретов. Можно попробовать реализовать это с помощью **TTL индексов**.


### Реализация:

- Проект реализован на **FastAPI**.
- СУБД **PostgreSQL**.
- Для взаимодействия с БД используется **SQLAlchemy**.
- Для произведения миграций БД настроен **Alembic**. Можно было обойтись и без него, использован только с целью того, чтобы разобраться как его настраивать и применять.
- Для валидации данных используется **Pydantic**.
- Сервис полностью асинхронен, асинхронна как обработка HTTP запросов, так и работа с БД. Для асинхронной работой с БД используется библиотека **Databases** совместно с **Asyncpg**.
- Сервис запускается с помощью **Docker** контейнеров.
- **Docker** так же используется для запуска и остановки тестовой среды, при проведении тестирования.
- Реализованы все усложнения из задания.


### Инструкция по запуску:

1) Для установки виртуального окружения и зависимостей необходимо выполнить команду:

        $ poetry install

2) Перед запуском контейнеров необходимо создать и заполнить файл **.env** (необходимые переменные окружения приведены в файле **.env.example**).

3) Для запуска сервиса необходимо выполнить команду:

        $ docker-compose up

4) Тесты написаны на **pytest**. Для запуска всех тестов необходимо выполнить команду:

         $ pytest --docker-compose=docker-compose-tests.yaml

    Для быстрого старта тестовой среды желательно предварительно осуществить сборку **Docker** образов. Так как тестовая и боевая среда основаны на одном **Dockerfile**, то для подготовки образов тестовой среды достаточно перед запуском тестов выполнить команду из пункта **№3**.
